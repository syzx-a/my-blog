# Hugo 自媒体网站 - 详细部署流程文档

> 从零开始部署你的个人自媒体网站，预计耗时：2-3小时

---

## 📋 前置准备

### 1.1 需要的账号

| 服务 | 用途 | 注册链接 |
|------|------|----------|
| **GitHub** | 代码托管、CI/CD | https://github.com/signup |
| **Vercel** | 网站托管 | https://vercel.com/signup |
| **域名服务商** (可选) | 购买域名 | 阿里云/腾讯云/Namecheap |

### 1.2 需要的工具

| 工具 | 版本要求 | 下载链接 |
|------|----------|----------|
| **Git** | 最新版 | https://git-scm.com/downloads |
| **Hugo** | v0.120+ | https://github.com/gohugoio/hugo/releases |
| **Node.js** | v18+ | https://nodejs.org/ |
| **VS Code** (推荐) | 最新版 | https://code.visualstudio.com/ |

### 1.3 检查安装

打开终端，运行以下命令检查工具是否安装成功：

```bash
# 检查 Git
git --version
# 输出示例：git version 2.43.0

# 检查 Hugo
hugo version
# 输出示例：hugo v0.121.0+extended...

# 检查 Node
node --version
# 输出示例：v20.10.0

# 检查 npm
npm --version
# 输出示例：10.2.3
```

---

## 🚀 第一阶段：项目初始化

### 2.1 创建 GitHub 仓库

1. 登录 GitHub：https://github.com
2. 点击右上角 **+** → **New repository**
3. 填写仓库信息：
   - **Repository name**: `my-blog` (或你喜欢的名字)
   - **Description**: 我的个人自媒体博客
   - **Visibility**: Public (推荐，免费使用 GitHub Pages)
   - **Initialize this repository with**: ✅ Add a README
4. 点击 **Create repository**

### 2.2 克隆项目到本地

```bash
# 进入你的工作目录
cd ~/Documents  # macOS/Linux
cd D:\Projects   # Windows

# 克隆仓库
git clone https://github.com/你的用户名/my-blog.git
cd my-blog
```

### 2.3 复制网站文件

将之前准备的 `website` 文件夹中的所有内容复制到项目根目录：

```bash
# 如果你下载了 website 文件夹
# 复制所有文件到当前目录

# macOS/Linux
cp -r /path/to/website/* .

# Windows PowerShell
Copy-Item -Path "D:\path\to\website\*" -Destination "." -Recurse
```

或者直接拖拽文件到项目文件夹。

### 2.4 安装 Hugo 主题

```bash
# 初始化 git 子模块（安装 PaperMod 主题）
git submodule add https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod

# 提交更改
git add .
git commit -m "Initial commit: Hugo blog setup"
git push origin main
```

---

## 🔧 第二阶段：本地配置

### 3.1 修改网站基本信息

编辑 `hugo.toml` 文件：

```toml
# 第1行：修改为你的域名（后续配置）
baseURL = 'https://my-blog.vercel.app'  # 临时使用 Vercel 域名

# 第3行：网站标题
title = '你的名字'

# 第6行：作者名字
author = '你的名字'

# 第7行：网站描述
description = '分享生活、旅行与创作的自媒体博主'
```

### 3.2 配置社交链接

在 `hugo.toml` 中找到 `[params.socialIcons]` 部分：

```toml
[[params.socialIcons]]
  name = 'bilibili'
  url = 'https://space.bilibili.com/你的B站ID'

[[params.socialIcons]]
  name = 'tiktok'
  url = 'https://www.douyin.com/user/你的抖音ID'

[[params.socialIcons]]
  name = 'instagram'
  url = 'https://www.instagram.com/你的ins账号'

[[params.socialIcons]]
  name = 'youtube'
  url = 'https://www.youtube.com/@你的YouTube账号'

[[params.socialIcons]]
  name = 'weibo'
  url = 'https://weibo.com/你的微博ID'

[[params.socialIcons]]
  name = 'email'
  url = 'mailto:你的邮箱@example.com'
```

### 3.3 配置关于页面

编辑 `content/about/_index.md`：

```markdown
---
title: "关于"
---

## 你好，我是 [你的名字] 👋

[在这里写你的个人简介...]
```

### 3.4 提交配置更改

```bash
git add .
git commit -m "Update site configuration"
git push origin main
```

---

## 💻 第三阶段：本地预览

### 4.1 启动开发服务器

```bash
# 在项目根目录运行
hugo server -D
```

### 4.2 访问网站

打开浏览器，访问：http://localhost:1313

你应该能看到：
- ✅ 首页显示你的个人简介
- ✅ 导航菜单（首页、图文、直播、关于）
- ✅ 示例文章列表
- ✅ 社交链接图标

### 4.3 常见问题

#### 问题1：主题未找到
**症状**：报错 `Error: Unable to find theme`

**解决**：
```bash
# 确保主题已正确安装
git submodule update --init --recursive
```

#### 问题2：端口被占用
**症状**：报错 `port 1313 already in use`

**解决**：
```bash
# 使用其他端口
hugo server -D -p 8080
```

#### 问题3：内容未显示
**症状**：页面空白或404

**解决**：
```bash
# 检查 content 目录是否有内容
ls content/posts/

# 确保文件使用正确的 frontmatter
head content/posts/*.md
```

---

## 🌐 第四阶段：Vercel 部署

### 5.1 安装 Vercel CLI

```bash
npm i -g vercel
```

### 5.2 登录 Vercel

```bash
vercel login
```

会打开浏览器让你授权，点击 **Continue** → **Authorize**。

### 5.3 部署到 Vercel

```bash
# 在项目根目录运行
vercel
```

按照提示操作：
1. **Set up and deploy "~/my-blog"?** → 输入 `Y`
2. **Which scope do you want to deploy to?** → 选择你的账号
3. **Link to existing project?** → 输入 `N` (创建新项目)
4. **What's your project name?** → 输入项目名称（如 `my-blog`）
5. **In which directory is your code located?** → 直接回车（使用当前目录`./`）

### 5.4 等待部署完成

Vercel 会自动：
1. 检测 Hugo 项目
2. 安装依赖
3. 构建网站
4. 分配域名（如 `my-blog.vercel.app`）

部署成功后，你会看到：
```
🔍  Inspect: https://vercel.com/你的用户名/my-blog/xxxxx
✅  Production: https://my-blog.vercel.app
```

### 5.5 验证部署

访问分配的域名，确认网站正常运行。

---

## 🔄 第五阶段：配置自动部署

### 6.1 获取 Vercel Token

1. 访问：https://vercel.com/account/tokens
2. 点击 **Create Token**
3. 填写名称：`GitHub Actions`
4. 点击 **Create Token**
5. **复制保存 Token**（只显示一次！）

### 6.2 获取组织/项目 ID

```bash
# 在项目根目录运行
vercel env ls
```

或者直接查看 `.vercel/project.json`：

```json
{
  "orgId": "你的组织ID",
  "projectId": "你的项目ID"
}
```

### 6.3 配置 GitHub Secrets

1. 打开 GitHub 仓库页面
2. 点击 **Settings** → **Secrets and variables** → **Actions**
3. 点击 **New repository secret**
4. 添加以下 Secrets：

| Name | Value |
|------|-------|
| `VERCEL_TOKEN` | 刚才复制的 Vercel Token |
| `VERCEL_ORG_ID` | 你的组织 ID |
| `VERCEL_PROJECT_ID` | 你的项目 ID |

### 6.4 测试自动部署

```bash
# 修改任意文件
echo "测试" >> README.md

# 提交并推送
git add .
git commit -m "Test auto deployment"
git push origin main
```

等待 1-2 分钟，访问网站查看是否更新。

---

## 🎨 第六阶段：配置 CMS 后台

### 7.1 创建 GitHub OAuth App

1. 访问：https://github.com/settings/developers
2. 点击 **OAuth Apps** → **New OAuth App**
3. 填写信息：
   - **Application name**: 我的博客 CMS
   - **Homepage URL**: `https://my-blog.vercel.app`
   - **Application description**: 博客内容管理系统
   - **Authorization callback URL**: `https://my-blog.vercel.app/admin/`
4. 点击 **Register application**
5. **复制 Client ID**
6. 点击 **Generate a new client secret**，**复制 Secret**

### 7.2 配置 Netlify Identity (推荐)

Decap CMS 需要身份验证服务，Netlify Identity 是最简单的方案：

1. 访问：https://app.netlify.com
2. 点击 **Add new site** → **Import an existing project**
3. 选择 GitHub 仓库授权
4. 选择你的博客仓库
5. 配置构建设置：
   - **Build command**: `hugo --minify`
   - **Publish directory**: `public`
6. 点击 **Deploy site**

等待部署完成后：

7. 进入 Site settings → **Identity**
8. 点击 **Enable Identity**
9. 进入 **Services** → **Git Gateway** → **Enable Git Gateway**
10. 进入 **Registration** → **Invite-only**（推荐，防止滥用）

### 7.3 更新 CMS 配置

编辑 `static/admin/config.yml`，更新 repo：

```yaml
backend:
  name: github
  branch: main
  repo: 你的用户名/my-blog  # 修改为你的仓库
```

如果使用 Netlify Identity：

```yaml
backend:
  name: git-gateway
  branch: main
```

### 7.4 提交并部署

```bash
git add .
git commit -m "Configure Decap CMS"
git push origin main
```

### 7.5 测试 CMS

访问 `https://my-blog.vercel.app/admin`

你应该看到：
- 登录界面
- 可以使用 GitHub 账号登录
- 能够创建和编辑文章

---

## 💬 第七阶段：配置评论系统

### 8.1 准备 GitHub 仓库

评论使用 Giscus，基于 GitHub Discussions。

确保你的博客仓库已启用 Discussions：

1. 打开 GitHub 仓库
2. 点击 **Settings**
3. 向下滚动找到 **Features**
4. 勾选 **Discussions**

### 8.2 安装 Giscus

1. 访问：https://github.com/apps/giscus
2. 点击 **Install**
3. 选择你的博客仓库
4. 点击 **Install**

### 8.3 获取配置参数

1. 访问：https://giscus.app/zh-CN
2. 填写信息：
   - **仓库**: `用户名/仓库名`
   - **页面 ↔️ discussion 映射关系**: `pathname`
   - **Discussion 分类**: `Announcements`
3. 复制生成的配置代码

### 8.4 更新 Hugo 配置

编辑 `hugo.toml`，找到 `[params.giscus]` 部分：

```toml
[params.giscus]
  repo = '你的用户名/你的仓库'
  repoId = '你的repoId'           # 从 giscus.app 获取
  category = 'Announcements'
  categoryId = '你的categoryId'   # 从 giscus.app 获取
  mapping = 'pathname'
  reactionsEnabled = '1'
  emitMetadata = '0'
  inputPosition = 'bottom'
  theme = 'light'
  lang = 'zh-CN'
```

### 8.5 启用文章评论

在文章 frontmatter 中添加：

```markdown
---
title: "文章标题"
comments: true  # 启用评论
---
```

或在 `hugo.toml` 中全局启用：

```toml
[params]
  comments = true
```

### 8.6 部署测试

```bash
git add .
git commit -m "Add Giscus comments"
git push origin main
```

等待部署完成后，访问任意文章页面，应该能看到评论框。

---

## 🌐 第八阶段：绑定自定义域名

### 9.1 购买域名（如果还没有）

推荐：
- **国内**: 阿里云、腾讯云（需要备案）
- **国外**: Namecheap、Cloudflare（无需备案）

### 9.2 Vercel 添加域名

1. 访问：https://vercel.com/dashboard
2. 进入你的项目
3. 点击 **Settings** → **Domains**
4. 输入你的域名（如 `yourname.com`）
5. 点击 **Add**

### 9.3 配置 DNS

根据 Vercel 的提示，在域名服务商处添加 DNS 记录：

**方案A：使用 A 记录**
```
类型: A
名称: @ 或 www
值: 76.76.21.21  # Vercel 的 IP
```

**方案B：使用 CNAME 记录（推荐）**
```
类型: CNAME
名称: www
值: cname.vercel-dns.com
```

### 9.4 更新 Hugo 配置

编辑 `hugo.toml`：

```toml
baseURL = 'https://yourname.com'  # 修改为你的域名
```

### 9.5 提交并等待生效

```bash
git add .
git commit -m "Update domain configuration"
git push origin main
```

DNS 生效可能需要几分钟到几小时。

---

## 🔍 第九阶段：验证与测试

### 10.1 功能检查清单

| 检查项 | 状态 | 备注 |
|--------|------|------|
| 首页正常显示 | ⬜ | |
| 文章列表页 | ⬜ | |
| 文章详情页 | ⬜ | |
| 直播列表页 | ⬜ | |
| 直播详情页 | ⬜ | |
| 关于页面 | ⬜ | |
| 搜索功能 | ⬜ | 访问 `/search` |
| 移动端适配 | ⬜ | 用手机访问测试 |
| CMS 后台登录 | ⬜ | 访问 `/admin` |
| 评论系统 | ⬜ | |
| 社交链接 | ⬜ | 点击测试 |

### 10.2 SEO 检查

访问以下地址检查：

```
https://yourdomain.com/sitemap.xml        # 站点地图
https://yourdomain.com/robots.txt         # 爬虫规则
```

### 10.3 性能测试

使用以下工具测试：

- **Google PageSpeed**: https://pagespeed.web.dev/
- **GTmetrix**: https://gtmetrix.com/

目标分数：
- 桌面端：90+
- 移动端：80+

---

## 🐛 故障排查

### 问题1：部署失败

**症状**：Vercel 构建失败

**排查步骤**：

```bash
# 1. 本地先测试构建
hugo --minify

# 2. 检查错误信息
# 常见错误：
# - 主题未安装 -> git submodule update --init
# - frontmatter 格式错误 -> 检查 YAML 语法
# - 图片路径错误 -> 使用相对路径
```

### 问题2：样式丢失

**症状**：网站显示纯文本，无样式

**解决**：
```bash
# 检查 baseURL 配置
# 确保 baseURL 与实际域名一致

# 强制刷新缓存
# Ctrl + F5 或 Cmd + Shift + R
```

### 问题3：CMS 无法登录

**症状**：点击登录无反应或报错

**排查**：
1. 检查 OAuth App 的 callback URL 是否正确
2. 确保仓库已安装 Giscus App
3. 检查浏览器控制台是否有错误

### 问题4：评论不显示

**症状**：文章底部没有评论框

**排查**：
1. 检查仓库是否启用 Discussions
2. 检查 giscus 配置参数是否正确
3. 检查文章是否启用 comments: true

---

## 📚 后续维护

### 日常更新流程

```bash
# 1. 拉取最新代码
git pull origin main

# 2. 创建新文章
hugo new content posts/新文章.md

# 3. 编辑内容
# 使用 VS Code 或其他编辑器

# 4. 本地预览
hugo server -D

# 5. 提交更改
git add .
git commit -m "Add new post: 文章标题"
git push origin main

# 6. 等待自动部署（约1-2分钟）
```

### 备份策略

代码已保存在 GitHub，自动备份。

如需备份图片等资源：

```bash
# 下载整个仓库
git clone https://github.com/你的用户名/my-blog.git backup-$(date +%Y%m%d)

# 或使用 GitHub 的导出功能
# Settings -> General -> Export repository
```

---

## 🎉 完成！

你现在拥有了一个功能完整的个人自媒体网站：

- ✅ 基于 Hugo 的静态网站
- ✅ 自动部署到 Vercel
- ✅ 可视化 CMS 后台
- ✅ 评论系统
- ✅ 响应式设计
- ✅ SEO 优化

开始创作吧！🚀

---

## 📞 获取帮助

遇到问题？

1. 查看 [Hugo 文档](https://gohugo.io/documentation/)
2. 查看 [PaperMod Wiki](https://github.com/adityatelange/hugo-PaperMod/wiki)
3. 在 GitHub 提交 Issue

---

*文档版本: v1.0*  
*最后更新: 2024年*
